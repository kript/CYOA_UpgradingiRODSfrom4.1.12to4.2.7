var storyContent = ﻿{"inkVersion":19,"root":[[{"#":"author: John Constable, 2020. john AT kript DOT net.  All opinions my own."},{"#":"theme: dark"},"^So, brave adventurer, you have decided to upgrade iRODS from 4.1.12 to 4.2.7 (oh! such riches! As I place finger to keyboard, 4.2.8 is released! Was all my testing for naught? I could have spent my time writing a talk for the UGM instead!)!","\n","^Are you running Ubuntu 12.04, 16.04 or 18.04 (surely, not so brave as to run 20.04)?","\n","ev","str","^12.04","/str","/ev",{"*":"0.c-0","flg":4},"ev","str","^16.04","/str","/ev",{"*":"0.c-1","flg":4},"ev","str","^18.04","/str","/ev",{"*":"0.c-2","flg":4},{"c-0":["\n","^You decide to upgrade on 12.04","\n",{"->":"precise"},{"->":"0.g-0"},{"#f":5}],"c-1":["^ ","\n","^You decide to upgrade on 16.04","\n",{"->":"trusty"},{"->":"0.g-0"},{"#f":5}],"c-2":["\n","^You decide to upgrade on 18.04","\n",{"->":"xenial"},{"->":"0.g-0"},{"#f":5}],"g-0":["done",{"#f":5}]}],"done",{"precise":[["^Oh, foolhardy fellow, 12.04 is Unsupported in the mighty 4.2. branch!","\n","^Grave trials lay before you.","\n","^Are you sure?","\n","ev","str","^Yes, I have so many old servers, I cannot upgrade them all before I must upgrade iRODS itself!","/str","/ev",{"*":".^.c-0","flg":4},["ev",{"^->":"precise.0.12.$r1"},{"temp=":"$r"},"str",{"->":".^.s"},[{"#n":"$r1"}],"/str","/ev",{"*":".^.^.c-1","flg":2},{"s":["^No, I must clearly upgrade all my servers OS first, which I shall do to 16.04! ",{"->":"$r","var":true},null]}],["ev",{"^->":"precise.0.13.$r1"},{"temp=":"$r"},"str",{"->":".^.s"},[{"#n":"$r1"}],"/str","/ev",{"*":".^.^.c-2","flg":2},{"s":["^No, I must clearly upgrade all my servers OS first, which I shall do to the latest released LTS (disclaimer; this was written before 20.04 was released)! ",{"->":"$r","var":true},null]}],{"c-0":["^ ",{"->":"precise_upgrade"},"\n",{"#f":5}],"c-1":["ev",{"^->":"precise.0.c-1.$r2"},"/ev",{"temp=":"$r"},{"->":".^.^.12.s"},[{"#n":"$r2"}],{"->":"trusty"},"\n",{"#f":5}],"c-2":["ev",{"^->":"precise.0.c-2.$r2"},"/ev",{"temp=":"$r"},{"->":".^.^.13.s"},[{"#n":"$r2"}],{"->":"xenial"},"\n",{"#f":5}]}],{"#f":1}],"trusty":[["^Ah, the *supported release* (Never mention that that 16.04 is due to be made obsolete when 20.04 comes out!).","\n","^You are wise, and assured of some success!","\n",["ev",{"^->":"trusty.0.4.$r1"},{"temp=":"$r"},"str",{"->":".^.s"},[{"#n":"$r1"}],"/str","/ev",{"*":".^.^.c-0","flg":2},{"s":["^Just one thing... did you know 16.04 runs systemd?",{"->":"$r","var":true},null]}],{"c-0":["ev",{"^->":"trusty.0.c-0.$r2"},"/ev",{"temp=":"$r"},{"->":".^.^.4.s"},[{"#n":"$r2"}],"\n","^Forewarned about systemd, you press on...","\n",{"->":"systemd"},{"#f":5}]}],{"#f":1}],"xenial":[["^Not yet supported, oh sage? Are you sure? Many dragons may be found, even the beast that lurks, the dreaded systemd! Although, it *is* the latest LTS release (yes, gentle reader, this was written before 20.04 graced us with its presence...)!","\n",["ev",{"^->":"xenial.0.2.$r1"},{"temp=":"$r"},"str",{"->":".^.s"},[{"#n":"$r1"}],"/str","/ev",{"*":".^.^.c-0","flg":2},{"s":["^I do not fear dragons, only poorly funded Principal Investigators. ",{"->":"$r","var":true},null]}],["ev",{"^->":"xenial.0.3.$r1"},{"temp=":"$r"},"str",{"->":".^.s"},[{"#n":"$r1"}],"/str","/ev",{"*":".^.^.c-1","flg":2},{"s":["^Crikey. Well, I guess I'll go for the supported release ",{"->":"$r","var":true},null]}],{"c-0":["ev",{"^->":"xenial.0.c-0.$r2"},"/ev",{"temp=":"$r"},{"->":".^.^.2.s"},[{"#n":"$r2"}],"\n",{"->":"xenial_upgrade"},{"#f":5}],"c-1":["ev",{"^->":"xenial.0.c-1.$r2"},"/ev",{"temp=":"$r"},{"->":".^.^.3.s"},[{"#n":"$r2"}],"\n",{"->":"trusty"},{"#f":5}]}],{"#f":1}],"precise_upgrade":[["^Very well, oh foolhardy one. You must compile iRODS yourself. Have you attempted this feat before?","\n",["ev",{"^->":"precise_upgrade.0.2.$r1"},{"temp=":"$r"},"str",{"->":".^.s"},[{"#n":"$r1"}],"/str","/ev",{"*":".^.^.c-0","flg":2},{"s":["^oh, yes, I have a script/docker container/Brett that does it for me! ",{"->":"$r","var":true},null]}],["ev",{"^->":"precise_upgrade.0.3.$r1"},{"temp=":"$r"},"str",{"->":".^.s"},[{"#n":"$r1"}],"/str","/ev",{"*":".^.^.c-1","flg":2},{"s":["^no, how hard can it be? ",{"->":"$r","var":true},null]}],{"c-0":["ev",{"^->":"precise_upgrade.0.c-0.$r2"},"/ev",{"temp=":"$r"},{"->":".^.^.2.s"},[{"#n":"$r2"}],"\n",{"->":"shredded_sanity"},{"#f":5}],"c-1":["ev",{"^->":"precise_upgrade.0.c-1.$r2"},"/ev",{"temp=":"$r"},{"->":".^.^.3.s"},[{"#n":"$r2"}],"\n",{"->":"hollow_laughter"},{"#f":5}]}],{"#f":1}],"shredded_sanity":[["^Your script runs, not knowing how many hours of toil went into making it work.","\n","^Perhaps you should ask Brett for a copy?","\n",["ev",{"^->":"shredded_sanity.0.4.$r1"},{"temp=":"$r"},"str",{"->":".^.s"},[{"#n":"$r1"}],"/str","/ev",{"*":".^.^.c-0","flg":2},{"s":["^He seems a nice fellow. I'll watch his talk at the UGM.",{"->":"$r","var":true},null]}],"ev","str","^Never! One should always seek to understand by doing oneself!","/str","/ev",{"*":".^.c-1","flg":4},{"c-0":["ev",{"^->":"shredded_sanity.0.c-0.$r2"},"/ev",{"temp=":"$r"},{"->":".^.^.4.s"},[{"#n":"$r2"}],"\n",{"->":"contact_brett"},{"#f":5}],"c-1":["^ ","\n","^Onwards, though my sanity creaks!","\n",{"->":"hollow_laughter"},{"#f":5}]}],{"#f":1}],"hollow_laughter":[["^\"Why this should be easy!\" You say. \"It's just C++ and cmake!\" Hours later, the dents in your wall and brusies on your forehead bespoke the great effort required to build 'externals' on a system it was never designed for, with hardcoded library versions not available on the OS you have chosen.","\n","ev","str","^wail with frustration","/str","/ev",{"*":".^.c-0","flg":4},["ev",{"^->":"hollow_laughter.0.8.$r1"},{"temp=":"$r"},"str",{"->":".^.s"},[{"#n":"$r1"}],"/str","/ev",{"*":".^.^.c-1","flg":2},{"s":["^You become a Consortium Member and plead for their help ",{"->":"$r","var":true},null]}],"ev","str","^grit your teeth","/str","/ev",{"*":".^.c-2","flg":4},["ev",{"^->":"hollow_laughter.0.15.$r1"},{"temp=":"$r"},"str",{"->":".^.s"},[{"#n":"$r1"}],"/str","/ev",{"*":".^.^.c-3","flg":2},{"s":["^Try again from the beginning.",{"->":"$r","var":true},null]}],{"c-0":["^ ","\n","^You decide to ask that nice Brett person. ",{"->":"contact_brett"},"\n",{"#f":5}],"c-1":["ev",{"^->":"hollow_laughter.0.c-1.$r2"},"/ev",{"temp=":"$r"},{"->":".^.^.8.s"},[{"#n":"$r2"}],"\n",{"->":"consortium"},{"#f":5}],"c-2":["^ ","\n","^compile all the packages manually","\n",{"->":".^.^.^"},{"#f":5}],"c-3":["ev",{"^->":"hollow_laughter.0.c-3.$r2"},"/ev",{"temp=":"$r"},{"->":".^.^.15.s"},[{"#n":"$r2"}],"\n",{"#":"RESTART"},{"->":"ending"},{"#f":5}]}],{"#f":1}],"consortium":["^The nice folks at RENCI welcome you to the consortium, and invite you to the hallowed chamber of the monthly Technical Working Group, where many great things are discussed.","\n","^They listen sagely to your troubles, but at the mention of 12.04 they shake thier heads sadly. \"This is insupported\" they reply somberly. \"We cannot support all OS's for all time and, regretfully, must decline support here. We do know those in the wider Community who have been able to do this, however, although we cannot condone it\"","\n","^[try to compile the software yourself]","\n",{"->":"hollow_laughter"},"^[search the iRODS_CHAT mailing list for answers]","\n",{"->":"contact_brett"},{"#f":1}],"contact_brett":["^He is also fond of the shaving of yaks, and is giving a talk at the UGM this year!","\n","^irods.org/ugm2020","\n",{"#":"LINKOPEN: https:///irods.org/ugm2020"},{"->":"upgrade"},{"#f":1}],"xenial_upgrade":["^Turns out the trusty packages work just fine! Splendid!","\n",{"#":"LINKOPEN: https:///youtu.be/n1SWHan4ST4?t=14"},"^Ah, apart from this whole systemd thing... ",{"->":"systemd"},"\n",{"#f":1}],"systemd":["^Lennart cackles. \"You didn't think it would be so easy, using the init.d emulator did you?\"","\n","^(check out issue 2774)","\n",{"#":"LINKOPEN: https:///github.com/irods/irods/issues/2774"},"^Cursing systemd, but prepared, you upgrade","\n",{"->":"upgrade"},{"#f":1}],"upgrade":[["^You install the packages you have obtained from ","ev",{"CNT?":"contact_brett"},"/ev",[{"->":".^.b","c":true},{"b":["^ Brett's ",{"->":".^.^.^.5"},null]}],"nop","^ ","ev",{"CNT?":"contact_brett"},"!","/ev",[{"->":".^.b","c":true},{"b":["^ RENCI's ",{"->":".^.^.^.12"},null]}],"nop","^ hard work and press on with the upgrade.","\n","ev","str","^install the icommands","/str","/ev",{"*":".^.c-0","flg":4},{"c-0":["^ ",{"->":"icommands"},"\n",{"#f":5}]}],{"#f":1}],"icommands":[["^You upgrade the icommands on all your clients to 4.2.7.","\n","^So... Do you use Federation?","\n","ev","str","^yes I use federation ","/str","/ev",{"*":".^.c-0","flg":4},"ev","str","^no, I have a single zone ","/str","/ev",{"*":".^.c-1","flg":4},{"c-0":["^   ",{"->":"federation"},"\n",{"#f":5}],"c-1":["^  ",{"->":"single_zone"},"\n",{"#f":5}]}],{"#f":1}],"single_zone":[["^Why, what a simple, trouble-free life you must lead, adventurer, how I envy you!","\n",["ev",{"^->":"single_zone.0.2.$r1"},{"temp=":"$r"},"str",{"->":".^.s"},[{"#n":"$r1"}],"/str","/ev",{"*":".^.^.c-0","flg":2},{"s":["^Onwards! ",{"->":"$r","var":true},null]}],{"c-0":["ev",{"^->":"single_zone.0.c-0.$r2"},"/ev",{"temp=":"$r"},{"->":".^.^.2.s"},[{"#n":"$r2"}],{"->":"database_q"},"\n",{"#f":5}]}],{"#f":1}],"federation":[["^Ah, you find that imeta doesn't work across Federation.","\n","^Perhaps you should upgrade to 4.2.8 instead, where this bug is fixed?","\n","^(check out issue 4426)","\n",{"#":"LINKOPEN: https:///github.com/irods/irods/issues/4426"},["ev",{"^->":"federation.0.7.$r1"},{"temp=":"$r"},"str",{"->":".^.s"},[{"#n":"$r1"}],"/str","/ev",{"*":".^.^.c-0","flg":2},{"s":["^Try again from the beginning. ",{"->":"$r","var":true},null]}],["ev",{"^->":"federation.0.8.$r1"},{"temp=":"$r"},"str",{"->":".^.s"},[{"#n":"$r1"}],"/str","/ev",{"*":".^.^.c-1","flg":2},{"s":["^Upgrade to 4.2.8 icommands ",{"->":"$r","var":true},null]}],{"c-0":["ev",{"^->":"federation.0.c-0.$r2"},"/ev",{"temp=":"$r"},{"->":".^.^.7.s"},[{"#n":"$r2"}],"\n",{"#":"RESTART"},"end",{"#f":5}],"c-1":["ev",{"^->":"federation.0.c-1.$r2"},"/ev",{"temp=":"$r"},{"->":".^.^.8.s"},[{"#n":"$r2"}],{"->":"mismatched_versions"},"\n",{"#f":5}]}],{"#f":1}],"mismatched_versions":[["^Beware! Only the same version is supported within a zone!","\n","^Dare you try it anyway?","\n","ev","str","^Yes","/str","/ev",{"*":".^.c-0","flg":4},"ev","str","^No","/str","/ev",{"*":".^.c-1","flg":4},["ev",{"^->":"mismatched_versions.0.16.$r1"},{"temp=":"$r"},"str",{"->":".^.s"},[{"#n":"$r1"}],"/str","/ev",{"*":".^.^.c-2","flg":2},{"s":["^Try again from the beginning. ",{"->":"$r","var":true},null]}],{"c-0":["^ ",{"->":"deprecated_microservices_q"},"\n",{"#f":5}],"c-1":["^ ",{"->":"deprecated_microservices_q"},"\n",{"#f":5}],"c-2":["ev",{"^->":"mismatched_versions.0.c-2.$r2"},"/ev",{"temp=":"$r"},{"->":".^.^.16.s"},[{"#n":"$r2"}],"\n",{"#":"RESTART"},"end",{"#f":5}]}],{"#f":1}],"deprecated_microservices_q":[["^Have you been following the path of iRODS for a while, possible since as far back as version 2.5?","\n","ev","str","^Yes","/str","/ev",{"*":".^.c-0","flg":4},"ev","str","^No","/str","/ev",{"*":".^.c-1","flg":4},{"c-0":["^ ",{"->":"started_with_25"},"\n",{"#f":5}],"c-1":["^ ",{"->":"modern_install"},"\n",{"#f":5}]}],{"#f":1}],"started_with_25":[["^Finding some \"failed to cast rule base file name entry to string\" errors in your logs (of course you check your logs after the upgrade! Don't you?), you discover that some Sys microservices have been deprecated.","\n","^(check out issue 4590)","\n",{"#":"LINKOPEN: https:///github.com/irods/irods/issues/4590"},"^A further look reveals more microservices that are deprecated. You carefully check if they are in use in your installation.","\n","^(check out issue 4665)","\n",{"#":"LINKOPEN: https:///github.com/irods/irods/issues/4665"},"ev","str","^Replace all the deprecated microservices","/str","/ev",{"*":".^.c-0","flg":4},{"c-0":["^ ",{"->":"database_q"},"\n",{"#f":5}]}],{"#f":1}],"modern_install":[["^With nothing amis in your logs, you press on, undaunted.","\n","ev","str","^Onwards!","/str","/ev",{"*":".^.c-0","flg":4},{"c-0":["^ ",{"->":"database_q"},"\n",{"#f":5}]}],{"#f":1}],"database_q":[["^You find yourself at a junction, a maze of twisty passages. Before you are three doors; you must choose one database as your backend..","\n","ev","str","^Oracle","/str","/ev",{"*":".^.c-0","flg":4},"ev","str","^PostgreSQL","/str","/ev",{"*":".^.c-1","flg":4},"ev","str","^MySQL","/str","/ev",{"*":".^.c-2","flg":4},{"c-0":["^ ",{"->":"oracle"},"\n",{"#f":5}],"c-1":["^ ",{"->":"otherdatabase"},"\n",{"#f":5}],"c-2":["^ ",{"->":"otherdatabase"},"\n",{"#f":5}]}],{"#f":1}],"otherdatabase":[["^Your find no database bugs here. You decide against turning over any more rocks.","\n",{"#":""},{"#":"more choices"},"ev","str","^continue with the upgrade","/str","/ev",{"*":".^.c-0","flg":4},{"c-0":["^ ",{"->":"ShowCollAcls"},"\n","end",{"#f":5}]}],{"#f":1}],"oracle":[["^Ah. a small thing. Tiny really. Did you know that database support was switched to ODBC and away from TNSNames?","\n","^(check out issue 3569)","\n",{"#":"LINKOPEN: https:///github.com/irods/irods/issues/3569"},"ev","str","^OK, time to upgrade","/str","/ev",{"*":".^.c-0","flg":4},{"c-0":["^ ",{"->":"databaseplugin"},"\n",{"#f":5}]}],{"#f":1}],"databaseplugin":[["^When you upgrade, you find that the database config didn't quite get converted from TNSNames to ODBC...","\n","^(check out issue 4603)","\n",{"#":"LINKOPEN: https:///github.com/irods/irods/issues/4603"},"^Is this a new server, or are you upgrading an existing installation?","\n","ev","str","^we build a new server to replace the old one ","/str","/ev",{"*":".^.c-0","flg":4},"ev","str","^We are upgrading an existing server ","/str","/ev",{"*":".^.c-1","flg":4},{"c-0":["^ ",{"->":"db_odbc_type"},"\n",{"#f":5}],"c-1":["^ ",{"->":"ShowCollAcls"},"\n",{"#f":5}]}],{"#f":1}],"db_odbc_type":[["^Once the upgrade script has finished running, you find that db_odbc_type: \"unix\" was migrated into server_config.json.","\n","^Everything seems to be fine though. I'm sure its nothing to worry about!","\n","^(check out issue 4664)","\n",{"#":"LINKOPEN: https:///github.com/irods/irods/issues/4664"},"ev","str","^ problems resolved, you start upgrading the resource servers ","/str","/ev",{"*":".^.c-0","flg":4},{"c-0":["^ ",{"->":"ires"},"\n",{"#f":5}]}],{"#f":1}],"ShowCollAcls":[["ev",{"CNT?":"deprecated_microservices_q"},"/ev",[{"->":".^.b","c":true},{"b":["\n","^As soon you type ils, your session crashes!","\n","^You need to install ShowCollAcls query. It was in the readme! For 4.2.8...","\n","^(check out issue 4636)","\n",{"#":"LINKOPEN: https:///github.com/irods/irods/issues/4636"},{"->":".^.^.^.4"},null]}],"nop","\n","ev","str","^ problems resolved, you start upgrading the resource servers  ","/str","/ev",{"*":".^.c-0","flg":4},{"c-0":["^ ",{"->":"ires"},"\n",{"#f":5}]}],{"#f":1}],"ires":[["^Do you use composite resource trees?","\n","ev","str","^yes, they are a mainstay of our deployment!","/str","/ev",{"*":".^.c-0","flg":4},"ev","str","^Hell, no, I craft all my traffic with rules as $DEITY intended!","/str","/ev",{"*":".^.c-1","flg":4},{"c-0":["^ ",{"->":"composite"},"\n",{"#f":5}],"c-1":["^ ",{"->":"no_composite"},"\n",{"#f":5}]}],{"#f":1}],"composite":[["^Did you stop the iRODS service before starting the upgrade?","\n","ev","str","^yes, of course, its the Undocumented Recommended Best Practice! ","/str","/ev",{"*":".^.c-0","flg":4},"ev","str","^no, why would I do that? ","/str","/ev",{"*":".^.c-1","flg":4},{"c-0":["^ ",{"->":"ending"},"\n",{"#f":5}],"c-1":["^ ",{"->":"delete_all_the_things"},"\n",{"#f":5}]}],{"#f":1}],"delete_all_the_things":[["^Because the packages are named differently, the post-remove scripts are run when the ires package is removed. This attempts to delete all the local resources. You didn't want that data did you?","\n","^(check out issue 4612)","\n",{"#":"LINKOPEN: https:///github.com/irods/irods/issues/4612"},["ev",{"^->":"delete_all_the_things.0.5.$r1"},{"temp=":"$r"},"str",{"->":".^.s"},[{"#n":"$r1"}],"/str","/ev",{"*":".^.^.c-0","flg":2},{"s":["^Fortunately, iRODs is more conservative that that! It requires the resources to be removed with iadmin rmresc first, so your data is safe! ",{"->":"$r","var":true},null]}],{"c-0":["ev",{"^->":"delete_all_the_things.0.c-0.$r2"},"/ev",{"temp=":"$r"},{"->":".^.^.5.s"},[{"#n":"$r2"}],{"->":"ending"},"\n",{"#f":5}]}],{"#f":1}],"no_composite":["^You chose wisely!","\n",{"->":"ending"},{"#":""},{"#":"more choices"},"end",{"#f":1}],"ending":[[{"#":"CLASS: end"},"^Older (and wiser?) you have upgraded to 4.2.7. Congratulations!","\n","^Ready to start on 4.2.8? I hear 4.2.9 might not be so far away, either...","\n","^The End.","\n","^I hope you enjoyed this alternative foray into some of the life of an iRODS administrator. Do drop me an email ( john AT kript DOT net. ) and let me know what you thought!","\n","^Apologies for the lack of working hyperlinks, but the released version of Ink doesn't support the commit for Issue 266, so they get stripped out. Should that change, I've left the links in the code for this project (on my github author: kript).","\n","^iRODS is a product of RENCI. irods.org","\n",{"#":"LINKOPEN: https:///irods.org"},"^This was inspired in large part by spending formative years playing Fighting Fantasy, and also by Robin Sloan's recent project;","\n",{"#":"LINKOPEN: https:///www.robinsloan.com/overworld/week/8"},["ev",{"^->":"ending.0.17.$r1"},{"temp=":"$r"},"str",{"->":".^.s"},[{"#n":"$r1"}],"/str","/ev",{"*":".^.^.c-0","flg":2},{"s":["^Try again from the beginning. ",{"->":"$r","var":true},null]}],{"c-0":["ev",{"^->":"ending.0.c-0.$r2"},"/ev",{"temp=":"$r"},{"->":".^.^.17.s"},[{"#n":"$r2"}],"\n",{"#":"RESTART"},"end","end",{"#f":5}]}],{"#f":1}],"#f":1}],"listDefs":{}};